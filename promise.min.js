/*
 * [promise.coffee](http://github.com/CodeCatalyst/promise.coffee) v1.0.6
 * Copyright (c) 2012-2013 [CodeCatalyst, LLC](http://www.codecatalyst.com/).
 * Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
 */
 (function(){var e,t,n,o,i,r,s,c,u,l,h;l=null!=("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?process.nextTick:"undefined"!=typeof setImmediate&&null!==setImmediate?setImmediate:function(e){return setTimeout(e,0)},e=function(){function e(){var e,t,n;n=new Array(1e4),t=0,e=function(){var e;for(e=0;t>e;)n[e](),n[e]=null,e++;t=0},this.schedule=function(o){n[t++]=o,1===t&&l(e)}}return e}(),r=new e,s=function(e){return r.schedule(e)},c=function(e){return e&&"function"==typeof e},u=function(e){return e&&"object"==typeof e},t=function(){function e(e,t){this.onFulfilled=e,this.onRejected=t,this.resolver=new i,this.promise=this.resolver.promise}return e.prototype.trigger=function(e,t){switch(e){case"fulfill":this.propagate(t,this.onFulfilled,this.resolver,this.resolver.resolve);break;case"reject":this.propagate(t,this.onRejected,this.resolver,this.resolver.reject)}},e.prototype.propagate=function(e,t,n,o){c(t)?s(function(){var o;try{n.resolve(t(e))}catch(i){o=i,n.reject(o)}}):o.call(n,e)},e}(),i=function(){function e(){this.promise=new o(this),this.consequences=[],this.completed=!1,this.completionAction=null,this.completionValue=null}return e.prototype.then=function(e,n){var o;return o=new t(e,n),this.completed?o.trigger(this.completionAction,this.completionValue):this.consequences.push(o),o.promise},e.prototype.resolve=function(e){var t,o,i,r;if(!this.completed)try{if(e===this.promise)throw new TypeError("A Promise cannot be resolved with itself.");if((u(e)||c(e))&&(c(r=e.then)||e instanceof n&&(r=e.promise.then))){o=!1;try{i=this,r.call(e,function(e){o||(o=!0,i.resolve(e))},function(e){o||(o=!0,i.reject(e))})}catch(s){t=s,o||this.reject(t)}}else this.complete("fulfill",e)}catch(s){t=s,this.reject(t)}},e.prototype.reject=function(e){this.completed||this.complete("reject",e)},e.prototype.complete=function(e,t){var n,o,i,r;for(this.completionAction=e,this.completionValue=t,this.completed=!0,r=this.consequences,o=0,i=r.length;i>o;o++)n=r[o],n.trigger(this.completionAction,this.completionValue);this.consequences=null},e}(),o=function(){function e(e){this.then=function(t,n){return e.then(t,n)}}return e}(),n=function(){function e(){var e;e=new i,this.promise=e.promise,this.resolve=function(t){return e.resolve(t)},this.reject=function(t){return e.reject(t)}}return e.resolve=function(t){var n;return n=new e,n.resolve(t),n.promise},e.reject=function(t){var n;return n=new e,n.reject(t),n.promise},e}(),h="undefined"!=typeof exports&&null!==exports?exports:window,h.Deferred=n,h.defer=function(){return new n}}).call(this);
